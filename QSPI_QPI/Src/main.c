#include "main.h"
#include "fm33fh0xx_fl.h"
#include "qspi.h"
#include "axs15231.h"
#include "fm25qxx_single.h"
#include "fm25qxx_dual.h"
#include "fm25qxx_quad.h"
#include "FM25Qxx_QPI.h"

uint32_t reg1;
uint32_t reg2;
uint32_t reg3;

uint8_t wBuff[256] = {
    0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22,
    0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
    0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
    0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33,
    0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44,
    0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
    0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00,	
    0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11,	
    0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22,	
    0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33,	
    0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44,	
    0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55,	
    0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66,	
    0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,	
    0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88,	
    0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99};

uint8_t rBuff1[256];
uint8_t rBuff2[256];

static void LCD_NRST_Init(void)
{
    FL_GPIO_InitTypeDef GPIO_InitStruct = {0};

    GPIO_InitStruct.pin           = FL_GPIO_PIN_8;
    GPIO_InitStruct.mode          = FL_GPIO_MODE_DIGITAL;
    GPIO_InitStruct.outputType    = FL_GPIO_OUTPUT_PUSHPULL;
    GPIO_InitStruct.pull          = FL_GPIO_BOTH_DISABLE;
    GPIO_InitStruct.remapPin      = FL_GPIO_PINREMAP_FUNCTON0;
    GPIO_InitStruct.driveStrength = FL_GPIO_DRIVESTRENGTH_X3;
    (void)FL_GPIO_Init(GPIOB, &GPIO_InitStruct);

    FL_GPIO_ResetOutputPin(GPIOB, FL_GPIO_PIN_8);
    FL_DelayMs(10);
    FL_GPIO_SetOutputPin(GPIOB, FL_GPIO_PIN_8);
}

int main(void)
{   
    /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
    /* SHOULD BE KEPT!!! */
    MF_Clock_Init();
    
    /* Configure the system clock */
    /* SHOULD BE KEPT!!! */
    MF_SystemClock_Config();
    
    /* Initialize FL Driver Library */
    /* SHOULD BE KEPT!!! */
    FL_Init();

    MF_Config_Init();

    QSpiInit();
    LCD_NRST_Init();
    AXS15231_QSPI_Init();
    AXS15231_ResetAndInit();


    AXS15231_SetWindow(0, 0, 239, 319);
    AXS15231_FillColor(AXS15231_RED, 240 * 320);

//    FM25QxxEnable_QE();
//    FM25QxxInit_QPI();
//    
//    reg1 = FM25QxxReadStatus1_QPI();
//    reg2 = FM25QxxReadStatus2_QPI();
//    reg3 = FM25QxxJEDECID_QPI();
//    
//    FM25QxxEraseSector_QPI(0x100000);
//    FM25QxxReadFast_QPI(0x100000, rBuff1, 256);
//    
//    FM25QxxProgramPage_QPI(0x100000, wBuff, 256);
//    FM25QxxReadFast_QPI(0x100000, rBuff1, 256);
//    
//    FM25QxxDeInit_QPI();      //退出QPI

    while(1)
    {     
       IWDT_Clr();    
    }
}


